<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Extraction Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #0A66C2;
        }
        .test-case {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .test-case.pass {
            border-left-color: #0A66C2;
        }
        .test-case.fail {
            border-left-color: #d32f2f;
        }
        .label {
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }
        .result {
            font-family: monospace;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            margin-top: 5px;
        }
        .pass-icon { color: #0A66C2; }
        .fail-icon { color: #d32f2f; }
        .summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1>üîß Company Name Extraction - Test Suite</h1>
    <p>Testing the improved company extraction logic with validation and filtering.</p>

    <div id="test-results"></div>
    <div id="summary" class="summary"></div>

    <script>
        // Import the validation logic
        const EMPLOYMENT_METADATA = [
          'Full-time', 'Part-time', 'Contract', 'Freelance', 'Internship',
          'Self-employed', 'Apprenticeship', 'Seasonal', 'Temporary',
          'Full time', 'Part time', 'Self employed',
          'Remote', 'Hybrid', 'On-site', 'Onsite'
        ];

        const JOB_KEYWORDS = [
          'Closing', 'Hiring', 'Recruiting', 'Looking', 'Seeking', 'Available',
          'Open to', 'Actively', 'Searching', 'Team', 'Lead', 'Manager',
          'Director', 'Senior', 'Junior', 'Principal', 'Staff', 'Chief'
        ];

        function cleanCompanyName(rawCompany) {
          if (!rawCompany || typeof rawCompany !== 'string') return '';

          let cleaned = rawCompany.trim();

          // Remove everything after ¬∑ (employment type separator)
          cleaned = cleaned.split('¬∑')[0].trim();

          // Remove everything after common separators
          cleaned = cleaned.split('|')[0].trim();
          cleaned = cleaned.split(' - ')[0].trim();

          // Check if it's employment metadata
          if (EMPLOYMENT_METADATA.some(meta =>
            cleaned.toLowerCase() === meta.toLowerCase() ||
            cleaned.toLowerCase().includes(meta.toLowerCase())
          )) {
            return ''; // Invalid company name
          }

          // Check if it's a job keyword only
          if (JOB_KEYWORDS.some(keyword =>
            cleaned.toLowerCase() === keyword.toLowerCase()
          )) {
            return ''; // Invalid company name
          }

          // Must be at least 2 characters and not just numbers
          if (cleaned.length < 2 || /^\d+$/.test(cleaned)) {
            return '';
          }

          return cleaned;
        }

        // Test cases
        const testCases = [
            {
                input: "Google ¬∑ Full-time",
                expected: "Google",
                description: "Standard format with employment type"
            },
            {
                input: "Microsoft",
                expected: "Microsoft",
                description: "Company name only"
            },
            {
                input: "Full-time",
                expected: "",
                description: "Employment type only (should be rejected)"
            },
            {
                input: "Amazon ¬∑ Part-time ¬∑ Remote",
                expected: "Amazon",
                description: "Multiple metadata tags"
            },
            {
                input: "Meta (Facebook)",
                expected: "Meta (Facebook)",
                description: "Company with parenthetical"
            },
            {
                input: "Closing",
                expected: "",
                description: "Job keyword only (should be rejected)"
            },
            {
                input: "Hiring",
                expected: "",
                description: "Job keyword (should be rejected)"
            },
            {
                input: "Apple Inc. ¬∑ Contract",
                expected: "Apple Inc.",
                description: "Company with Inc. suffix"
            },
            {
                input: "Tesla, Inc.",
                expected: "Tesla, Inc.",
                description: "Company with comma and Inc"
            },
            {
                input: "RCG, Inc. ¬∑ Full-time",
                expected: "RCG, Inc.",
                description: "Real example from testing"
            },
            {
                input: "Manager",
                expected: "",
                description: "Job title only (should be rejected)"
            },
            {
                input: "Remote",
                expected: "",
                description: "Work arrangement only (should be rejected)"
            },
            {
                input: "Accenture | Full-time",
                expected: "Accenture",
                description: "Pipe separator"
            },
            {
                input: "IBM - Software Engineer",
                expected: "IBM",
                description: "Dash separator with title"
            },
            {
                input: "Self-employed",
                expected: "",
                description: "Self-employed status (should be rejected)"
            }
        ];

        // Run tests
        let passed = 0;
        let failed = 0;
        const resultsDiv = document.getElementById('test-results');

        testCases.forEach((test, index) => {
            const result = cleanCompanyName(test.input);
            const isPass = result === test.expected;

            if (isPass) passed++;
            else failed++;

            const testDiv = document.createElement('div');
            testDiv.className = `test-case ${isPass ? 'pass' : 'fail'}`;
            testDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div class="label">Test ${index + 1}: ${test.description}</div>
                        <div class="result">
                            <strong>Input:</strong> "${test.input}"<br>
                            <strong>Expected:</strong> "${test.expected}"<br>
                            <strong>Got:</strong> "${result}"
                        </div>
                    </div>
                    <div style="font-size: 30px; margin-left: 20px;">
                        ${isPass ? '<span class="pass-icon">‚úÖ</span>' : '<span class="fail-icon">‚ùå</span>'}
                    </div>
                </div>
            `;
            resultsDiv.appendChild(testDiv);
        });

        // Display summary
        const summaryDiv = document.getElementById('summary');
        const passRate = ((passed / testCases.length) * 100).toFixed(0);
        summaryDiv.innerHTML = `
            <h2>üìä Test Summary</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div>
                    <div class="label">Total Tests</div>
                    <div style="font-size: 32px; font-weight: bold;">${testCases.length}</div>
                </div>
                <div>
                    <div class="label">Passed</div>
                    <div style="font-size: 32px; font-weight: bold; color: #0A66C2;">${passed}</div>
                </div>
                <div>
                    <div class="label">Failed</div>
                    <div style="font-size: 32px; font-weight: bold; color: #d32f2f;">${failed}</div>
                </div>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: ${failed === 0 ? '#e8f5e9' : '#ffebee'}; border-radius: 8px;">
                <strong style="font-size: 20px;">
                    ${failed === 0 ? 'üéâ All tests passed! Company extraction is working correctly.' : `‚ö†Ô∏è ${failed} test(s) failed. Please review the logic.`}
                </strong>
                <div style="margin-top: 10px;">Pass Rate: ${passRate}%</div>
            </div>
        `;
    </script>
</body>
</html>
